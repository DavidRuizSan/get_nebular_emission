
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>get_nebular_emission.eml_une &#8212; get_nebular_emission 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">get_nebular_emission 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">get_nebular_emission.eml_une</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for get_nebular_emission.eml_une</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">get_nebular_emission.eml_const</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">get_nebular_emission.stats</span> <span class="kn">import</span> <span class="n">perc_2arrays</span>
<span class="kn">from</span> <span class="nn">get_nebular_emission.eml_io</span> <span class="kn">import</span> <span class="n">get_nheader</span>


<div class="viewcode-block" id="bursttobulge"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.bursttobulge">[docs]</a><span class="k">def</span> <span class="nf">bursttobulge</span><span class="p">(</span><span class="n">lms</span><span class="p">,</span><span class="n">Lagn_param</span><span class="p">):</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Lagn_param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lms</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span>
    <span class="n">lms</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Lagn_param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span></div>
    
    
<div class="viewcode-block" id="epsilon_MZ"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.epsilon_MZ">[docs]</a><span class="k">def</span> <span class="nf">epsilon_MZ</span><span class="p">(</span><span class="n">lms</span><span class="p">,</span><span class="n">lz</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">epsilon_a_sfr</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">epsilon_b_sfr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">lms</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">lz</span></div>

<div class="viewcode-block" id="Z_blanc"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.Z_blanc">[docs]</a><span class="k">def</span> <span class="nf">Z_blanc</span><span class="p">(</span><span class="n">logM_or</span><span class="p">):</span>
    <span class="n">logZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">logM_or</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">logM</span> <span class="o">=</span> <span class="n">logM_or</span> <span class="o">-</span> <span class="mf">9.35</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">logM_or</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">logM_or</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">logM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="mf">8.7</span><span class="o">-</span><span class="mf">9.35</span><span class="p">):</span>
                <span class="n">logZ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.37</span>
            <span class="k">elif</span> <span class="n">logM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="mf">9.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">):</span>
                <span class="n">logZ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.37</span> <span class="o">+</span> <span class="mf">0.14</span><span class="o">*</span><span class="n">logM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.14</span><span class="o">*</span><span class="p">(</span><span class="mf">8.7</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">logM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="mf">10.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">):</span>
                <span class="n">logZ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.37</span> <span class="o">+</span> <span class="mf">0.14</span><span class="o">*</span><span class="p">(</span><span class="mf">9.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.14</span><span class="o">*</span><span class="p">(</span><span class="mf">8.7</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.37</span><span class="o">*</span><span class="n">logM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.37</span><span class="o">*</span><span class="p">(</span><span class="mf">9.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logZ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.37</span> <span class="o">+</span> <span class="mf">0.14</span><span class="o">*</span><span class="p">(</span><span class="mf">9.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.14</span><span class="o">*</span><span class="p">(</span><span class="mf">8.7</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.37</span><span class="o">*</span><span class="p">(</span><span class="mf">10.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.37</span><span class="o">*</span><span class="p">(</span><span class="mf">9.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.03</span><span class="o">*</span><span class="n">logM</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="o">*</span><span class="p">(</span><span class="mf">10.5</span><span class="o">-</span><span class="mf">9.35</span><span class="p">)</span>
            
    <span class="n">logZ</span> <span class="o">=</span> <span class="n">logZ</span> <span class="o">-</span> <span class="n">const</span><span class="o">.</span><span class="n">ohsun</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">zsun</span><span class="p">)</span> <span class="c1"># We leave it in log(Z)</span>
    
    <span class="k">return</span> <span class="n">logZ</span></div>

<div class="viewcode-block" id="Z_tremonti"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.Z_tremonti">[docs]</a><span class="k">def</span> <span class="nf">Z_tremonti</span><span class="p">(</span><span class="n">logM</span><span class="p">,</span><span class="n">logZ</span><span class="p">,</span><span class="n">Lagn_param</span><span class="o">=</span><span class="p">[[</span><span class="kc">None</span><span class="p">],[</span><span class="kc">None</span><span class="p">]]):</span> <span class="c1"># Ms and Z scale relation from Tremonti et. al. 2004</span>
    
    <span class="c1"># logZ = -1.492 + 1.847*logM - 0.08026*logM**2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logZ</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Lagn_param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logMt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">logM</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Lagn_param</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logMt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">logM</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="o">**</span><span class="n">logM</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">logZ</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.492</span> <span class="o">+</span> <span class="mf">1.847</span><span class="o">*</span><span class="n">logMt</span> <span class="o">-</span> <span class="mf">0.08026</span><span class="o">*</span><span class="n">logMt</span><span class="o">**</span><span class="mi">2</span>
            <span class="c1"># logZ[:,1] = -1.492 + 1.847*logMt - 0.08026*logMt**2</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logZ</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.492</span> <span class="o">+</span> <span class="mf">1.847</span><span class="o">*</span><span class="n">logM</span> <span class="o">-</span> <span class="mf">0.08026</span><span class="o">*</span><span class="n">logM</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="n">logZ</span> <span class="o">=</span> <span class="n">logZ</span> <span class="o">-</span> <span class="n">const</span><span class="o">.</span><span class="n">ohsun</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">zsun</span><span class="p">)</span> <span class="c1"># We leave it in log(Z)</span>
    
    <span class="k">return</span> <span class="n">logMt</span><span class="p">,</span> <span class="n">logZ</span></div>

<div class="viewcode-block" id="Z_tremonti2"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.Z_tremonti2">[docs]</a><span class="k">def</span> <span class="nf">Z_tremonti2</span><span class="p">(</span><span class="n">logM</span><span class="p">,</span><span class="n">logZ</span><span class="p">,</span><span class="n">minZ</span><span class="p">,</span><span class="n">maxZ</span><span class="p">,</span><span class="n">Lagn_param</span><span class="o">=</span><span class="p">[[</span><span class="kc">None</span><span class="p">],[</span><span class="kc">None</span><span class="p">]]):</span> <span class="c1"># Correction in bins to Z values using the Ms and Z scale relation from Tremonti et. al. 2004</span>
    
    <span class="n">logZt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">logZ</span><span class="p">)</span>    

    <span class="n">logMtot</span><span class="p">,</span> <span class="n">logZt</span> <span class="o">=</span> <span class="n">Z_tremonti</span><span class="p">(</span><span class="n">logM</span><span class="p">,</span><span class="n">logZt</span><span class="p">,</span><span class="n">Lagn_param</span><span class="p">)</span>
    <span class="c1"># logZt = Z_blanc(logM)</span>
    
    <span class="n">logZtot</span> <span class="o">=</span> <span class="n">logZ</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logZt</span> <span class="o">=</span> <span class="n">logZt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">ind_lims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">logZtot</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">minZ</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">logZtot</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">maxZ</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">smin</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">smax</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">sbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">smin</span><span class="p">,</span> <span class="p">(</span><span class="n">smax</span> <span class="o">+</span> <span class="n">ds</span><span class="p">),</span> <span class="n">ds</span><span class="p">)</span>
    <span class="n">sbinsH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">smin</span><span class="p">,</span> <span class="n">smax</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
    <span class="n">shist</span> <span class="o">=</span> <span class="n">sbinsH</span> <span class="o">+</span> <span class="n">ds</span> <span class="o">*</span> <span class="mf">0.5</span>

    <span class="n">median</span> <span class="o">=</span> <span class="n">perc_2arrays</span><span class="p">(</span><span class="n">sbins</span><span class="p">,</span> <span class="n">logMtot</span><span class="p">[</span><span class="n">ind_lims</span><span class="p">],</span> <span class="n">logZtot</span><span class="p">[</span><span class="n">ind_lims</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">median_t</span> <span class="o">=</span> <span class="n">perc_2arrays</span><span class="p">(</span><span class="n">sbins</span><span class="p">,</span> <span class="n">logMtot</span><span class="p">[</span><span class="n">ind_lims</span><span class="p">],</span> <span class="n">logZt</span><span class="p">[</span><span class="n">ind_lims</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ind_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">median</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">999.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">shist</span> <span class="o">=</span> <span class="n">shist</span><span class="p">[</span><span class="n">ind_med</span><span class="p">]</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">median</span><span class="p">[</span><span class="n">ind_med</span><span class="p">]</span>
    <span class="n">median_t</span> <span class="o">=</span> <span class="n">median_t</span><span class="p">[</span><span class="n">ind_med</span><span class="p">]</span>
    
    <span class="n">final_bin</span> <span class="o">=</span> <span class="n">sbins</span><span class="p">[</span><span class="n">ind_med</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sbins</span> <span class="o">=</span> <span class="n">sbins</span><span class="p">[</span><span class="n">ind_med</span><span class="p">]</span>
    <span class="n">sbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sbins</span><span class="p">,</span><span class="n">final_bin</span><span class="p">)</span>
    
    <span class="n">dif</span> <span class="o">=</span> <span class="n">median_t</span> <span class="o">-</span> <span class="n">median</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sbins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">logMtot</span><span class="o">&gt;</span><span class="n">sbins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">logMtot</span><span class="o">&lt;</span><span class="n">sbins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># print(sbins[i],sbins[i+1],median[i],median_t[i],dif[i])</span>
        <span class="n">logZ</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">logZ</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">logZ</span></div>
    

<div class="viewcode-block" id="Ledd"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.Ledd">[docs]</a><span class="k">def</span> <span class="nf">Ledd</span><span class="p">(</span><span class="n">Mbh</span><span class="p">):</span> <span class="c1"># Eddington luminosity</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the black hole, calculates the Eddington luminosity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Mbh : floats</span>
<span class="sd">     Mass of the black hole (Msun).</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Ledd : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">Ledd</span> <span class="o">=</span> <span class="mf">1.26e38</span><span class="o">*</span><span class="n">Mbh</span> <span class="c1"># erg s^-1</span>
    <span class="k">return</span> <span class="n">Ledd</span></div>
    

<div class="viewcode-block" id="acc_rate_edd"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.acc_rate_edd">[docs]</a><span class="k">def</span> <span class="nf">acc_rate_edd</span><span class="p">(</span><span class="n">Mbh</span><span class="p">):</span> <span class="c1"># Eddington mass accretion rate</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the black hole, calculates the eddington accretion rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Mbh : floats</span>
<span class="sd">     Mass of the black hole (Msun).</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    acc_rate : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">Ledd</span><span class="p">(</span><span class="n">Mbh</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">kg_to_Msun</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># Msun/s</span>
    <span class="k">return</span> <span class="n">acc_rate</span></div>

<div class="viewcode-block" id="t_bulge"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.t_bulge">[docs]</a><span class="k">def</span> <span class="nf">t_bulge</span><span class="p">(</span><span class="n">r_bulge</span><span class="p">,</span> <span class="n">v_bulge</span><span class="p">):</span> <span class="c1"># Dynamical timescale of the bulge</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the bulge&#39;s half-mass radius and circular velocity at the half-mass radius,</span>
<span class="sd">    calculates the dynamical timescale of the bulge.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_bulge : floats</span>
<span class="sd">     Half-mass radius of the bulge (Mpc).</span>
<span class="sd">    v_bulge : floats</span>
<span class="sd">     Circular velocity at the half-mass radius of the bulge (km/s).</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dyn_time : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">dyn_time</span> <span class="o">=</span> <span class="n">r_bulge</span><span class="o">/</span><span class="n">v_bulge</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">Mpc_to_cm</span> <span class="c1"># s</span>
    <span class="k">return</span> <span class="n">dyn_time</span></div>

<div class="viewcode-block" id="acc_rate_quasar"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.acc_rate_quasar">[docs]</a><span class="k">def</span> <span class="nf">acc_rate_quasar</span><span class="p">(</span><span class="n">M_bulge</span><span class="p">,</span> <span class="n">r_bulge</span><span class="p">,</span> <span class="n">v_bulge</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the bulge, the half-mass radius and circular velocity </span>
<span class="sd">    at the half-mass radius, calculates the accretion rate of the quasar (starburst) mode.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    M_bulge : floats</span>
<span class="sd">     Mass of the bulge (Msun)</span>
<span class="sd">    r_bulge : floats</span>
<span class="sd">     Half-mass radius of the bulge (Mpc).</span>
<span class="sd">    v_bulge : floats</span>
<span class="sd">     Circular velocity at the half-mass radius of the bulge (km/s).</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    acc_rate : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">M_bulge</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">fbh</span><span class="o">/</span><span class="p">(</span><span class="n">t_bulge</span><span class="p">(</span><span class="n">r_bulge</span><span class="p">,</span> <span class="n">v_bulge</span><span class="p">)</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">fq</span><span class="p">)</span> <span class="c1"># Msun/s</span>
    <span class="k">return</span> <span class="n">acc_rate</span></div>

<div class="viewcode-block" id="acc_rate_radio"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.acc_rate_radio">[docs]</a><span class="k">def</span> <span class="nf">acc_rate_radio</span><span class="p">(</span><span class="n">Mhot</span><span class="p">,</span> <span class="n">Mbh</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the hot gas and the mass of the black hole, calculates</span>
<span class="sd">    the accretion rate of the radio (hot gas) mode.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Mhot : floats</span>
<span class="sd">     Mass of the hot gas (Msun).</span>
<span class="sd">    Mbh : floats</span>
<span class="sd">     Mass of the black hole (Msun).</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    acc_rate : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">kappa_agn</span><span class="o">*</span><span class="p">(</span><span class="n">Mhot</span><span class="o">*</span><span class="n">Mbh</span><span class="o">*</span><span class="mf">1e-19</span><span class="p">)</span><span class="o">**</span><span class="n">const</span><span class="o">.</span><span class="n">kappa_agn_exp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.154e7</span><span class="p">)</span> <span class="c1"># Msun/s</span>
    <span class="k">return</span> <span class="n">acc_rate</span></div>

<div class="viewcode-block" id="r_iso"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.r_iso">[docs]</a><span class="k">def</span> <span class="nf">r_iso</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span>
    <span class="n">Z1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spin</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spin</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">Z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Z1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r_iso</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">Z2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">3</span><span class="o">-</span><span class="n">Z1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="n">Z1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Z2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">r_iso</span></div>
    
<div class="viewcode-block" id="epsilon_td"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.epsilon_td">[docs]</a><span class="k">def</span> <span class="nf">epsilon_td</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r_iso</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>
    <span class="n">epsilon_td</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">r</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Radiative accretion efficiency for a thin accretion disc (general approximation, page 5)</span>
    
    <span class="k">return</span> <span class="n">epsilon_td</span></div>

<span class="c1"># AGNinputs = [&#39;Lagn&#39;, &#39;acc_rate&#39;, &#39;acc_rates&#39;, &#39;radio_mode&#39;, &#39;quasar_mode&#39;, &#39;complete&#39;]</span>
<div class="viewcode-block" id="L_agn"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.L_agn">[docs]</a><span class="k">def</span> <span class="nf">L_agn</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">,</span><span class="n">AGNinputs</span><span class="o">=</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    It reads parameters from the input file from which it can calculate or get the </span>
<span class="sd">    AGN luminosities and returns those values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">     - Name of the input file. </span>
<span class="sd">     - In text files (*.dat, *txt, *.cat), columns separated by &#39; &#39;.</span>
<span class="sd">     - In csv files (*.csv), columns separated by &#39;,&#39;.</span>
<span class="sd">    inputformat : string</span>
<span class="sd">     Format of the input file.</span>
<span class="sd">    AGNinputs : string</span>
<span class="sd">     Type of inputs for AGN&#39;s bolometric luminosity calculations.</span>
<span class="sd">    Lagn_params : list</span>
<span class="sd">     Inputs for AGN&#39;s bolometric luminosity calculations.</span>
<span class="sd">     - For text or csv files: list of integers with column position.</span>
<span class="sd">     - For hdf5 files: list of data names.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">      If True print out messages.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Lagn : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">AGNinputs</span><span class="o">==</span><span class="s1">&#39;Lagn&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># erg s^-1</span>
    <span class="k">elif</span> <span class="n">AGNinputs</span><span class="o">==</span><span class="s1">&#39;acc_rate&#39;</span><span class="p">:</span>
        <span class="n">Mdot</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">yr_to_s</span><span class="p">)</span>
        <span class="n">Mbh</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Mbh</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">const</span><span class="o">.</span><span class="n">spin_bh</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">AGNinputs</span><span class="o">==</span><span class="s1">&#39;acc_rates&#39;</span><span class="p">:</span>
        <span class="n">Mdot</span> <span class="o">=</span> <span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">yr_to_s</span><span class="p">)</span>   
        <span class="n">Mbh</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Mbh</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">const</span><span class="o">.</span><span class="n">spin_bh</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">AGNinputs</span><span class="o">==</span><span class="s1">&#39;radio_mode&#39;</span><span class="p">:</span>
        <span class="n">Mdot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ind_radio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Mdot</span><span class="p">[</span><span class="n">ind_radio</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_rate_radio</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind_radio</span><span class="p">],</span> 
                                               <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind_radio</span><span class="p">])</span>
        <span class="n">Mbh</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Mbh</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">const</span><span class="o">.</span><span class="n">spin_bh</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">AGNinputs</span><span class="o">==</span><span class="s1">&#39;quasar_mode&#39;</span><span class="p">:</span>
        <span class="n">Mdot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ind_quasar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Mdot</span><span class="p">[</span><span class="n">ind_quasar</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_rate_quasar</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind_quasar</span><span class="p">],</span> 
                                <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind_quasar</span><span class="p">],</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ind_quasar</span><span class="p">])</span>
        <span class="n">Mbh</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Mbh</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">const</span><span class="o">.</span><span class="n">spin_bh</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">AGNinputs</span><span class="o">==</span><span class="s1">&#39;complete&#39;</span><span class="p">:</span> <span class="c1">#Mbulg, rbulg, vbulg, Mhot, Mbh</span>
        <span class="n">Mdot_quasar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Mdot_radio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
        <span class="n">ind_quasar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Mdot_quasar</span><span class="p">[</span><span class="n">ind_quasar</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_rate_quasar</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind_quasar</span><span class="p">],</span> 
                                <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind_quasar</span><span class="p">],</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ind_quasar</span><span class="p">])</span>
        
        <span class="n">ind_radio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Mdot_radio</span><span class="p">[</span><span class="n">ind_radio</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_rate_radio</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">ind_radio</span><span class="p">],</span> 
                                               <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">ind_radio</span><span class="p">])</span>
        
        <span class="n">Mdot</span> <span class="o">=</span> <span class="n">Mdot_radio</span> <span class="o">+</span> <span class="n">Mdot_quasar</span>
        
        <span class="n">Mbh</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Lagn_params_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Lagn_params_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">Mbh</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">const</span><span class="o">.</span><span class="n">spin_bh</span><span class="p">)</span>
    
    <span class="n">Mdot_edd</span> <span class="o">=</span> <span class="n">acc_rate_edd</span><span class="p">(</span><span class="n">Mbh</span><span class="p">)</span>
    
    <span class="n">mdot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Mdot</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">bh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Mdot_edd</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mdot</span><span class="p">[</span><span class="n">bh</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mdot</span><span class="p">[</span><span class="n">bh</span><span class="p">]</span><span class="o">/</span><span class="n">Mdot_edd</span><span class="p">[</span><span class="n">bh</span><span class="p">]</span>
    
    <span class="n">Lagn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mdot</span><span class="p">))</span>
    <span class="c1"># n1, n2, n3, n4, n0 = [],[],[],[],[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Lagn</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># n0.append(i)</span>
            <span class="k">continue</span>
        
        <span class="c1"># Lagn[i] = epsilon_td(const.spin_bh)*Mdot[i]*const.c**2 * (1000/const.kg_to_Msun)</span>
        
        <span class="k">if</span> <span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">const</span><span class="o">.</span><span class="n">acc_rate_crit_visc</span><span class="p">:</span>
            <span class="c1"># n1.append(i)</span>
            <span class="n">Lagn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">epsilon_td</span><span class="p">(</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">Mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">alpha_adaf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">const</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="n">r_iso</span><span class="p">(</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">kg_to_Msun</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">const</span><span class="o">.</span><span class="n">acc_rate_crit_adaf</span><span class="p">:</span>
            <span class="c1"># n2.append(i)</span>
            <span class="n">Lagn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">epsilon_td</span><span class="p">(</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">Mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">alpha_adaf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">beta</span><span class="o">/</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="n">r_iso</span><span class="p">(</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">kg_to_Msun</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">const</span><span class="o">.</span><span class="n">eta_edd</span><span class="p">:</span>
            <span class="c1"># n3.append(i)</span>
            <span class="n">Lagn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilon_td</span><span class="p">(</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">Mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">kg_to_Msun</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># n4.append(i)</span>
            <span class="n">Lagn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">eta_edd</span><span class="o">*</span><span class="n">Ledd</span><span class="p">(</span><span class="n">Mbh</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mdot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">eta_edd</span><span class="p">))</span>
            
    <span class="c1"># logLagn = np.log10(Lagn)</span>
    <span class="c1"># print(len(n1),len(n2),len(n3),len(n4))</span>
    <span class="c1"># print(np.mean(logLagn[n1]),np.mean(logLagn[n2]),np.mean(logLagn[n3]))</span>
        
    <span class="k">return</span> <span class="n">Lagn</span> <span class="c1"># erg s^-1</span></div>

<span class="c1">########################</span>

<div class="viewcode-block" id="alpha_B"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.alpha_B">[docs]</a><span class="k">def</span> <span class="nf">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the temperature of the ionizing region, it interpolates from Osterbrock &amp; Ferland 2006</span>
<span class="sd">    tables the corresponding value of the hydrogen case B recombination coefficient.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    T : floats</span>
<span class="sd">     Typical temperature considered for nebular regions.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    alphaB : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">temps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.54e-13</span><span class="p">,</span> <span class="mf">2.59e-13</span><span class="p">,</span> <span class="mf">1.43e-13</span><span class="p">]</span> <span class="c1"># Osterbrock &amp; Ferland 2006, Second Edition, page 22</span>
    
    <span class="n">alphaB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">temps</span><span class="p">,</span><span class="n">values</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">alphaB</span></div>

<div class="viewcode-block" id="Rsch"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.Rsch">[docs]</a><span class="k">def</span> <span class="nf">Rsch</span><span class="p">(</span><span class="n">Mbh</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the black hole, it calculates the Schwarzschild radius.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Mbh : floats</span>
<span class="sd">     Mass of the black hole (Msun)</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Rs : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">Rs</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="n">Mbh</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">*</span> <span class="mf">3.086e19</span> <span class="c1">#km</span>
    <span class="k">return</span> <span class="n">Rs</span></div>

<div class="viewcode-block" id="surface_density"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.surface_density">[docs]</a><span class="k">def</span> <span class="nf">surface_density</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reff</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the surface density at that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : floats</span>
<span class="sd">     Distance to the center in which surface density is going to be calculated (Mpc).</span>
<span class="sd">    M : floats</span>
<span class="sd">     Mass of the desired component of the galaxy (Msun).</span>
<span class="sd">    reff : floats</span>
<span class="sd">     Effective radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">     Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    surf_den : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exponential&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">profile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;STOP (eml_une): Unrecognised profile for the surface density.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;                Possible profiles= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profiles</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">profile</span><span class="o">==</span><span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
        <span class="n">central</span> <span class="o">=</span> <span class="n">M</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">reff</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="n">surf_den</span> <span class="o">=</span> <span class="n">central</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="n">reff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surf_den</span></div>
    
<div class="viewcode-block" id="enclosed_mass_disk"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.enclosed_mass_disk">[docs]</a><span class="k">def</span> <span class="nf">enclosed_mass_disk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reff</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the surface density at that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : floats</span>
<span class="sd">     Distance to the center in which surface density is going to be calculated (Mpc).</span>
<span class="sd">    M : floats</span>
<span class="sd">     Mass of the desired component of the galaxy (Msun).</span>
<span class="sd">    reff : floats</span>
<span class="sd">     Effective radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">     Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    surf_den : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exponential&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">profile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;STOP (eml_une): Unrecognised profile for the surface density.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;                Possible profiles= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profiles</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">profile</span><span class="o">==</span><span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">M</span><span class="o">&gt;</span><span class="mf">1e-5</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">reff</span><span class="o">&gt;</span><span class="mf">1e-5</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mass_enclosed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mass_enclosed</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mass_enclosed</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
            
        <span class="k">return</span> <span class="n">mass_enclosed</span></div>
    

    
<div class="viewcode-block" id="enclosed_mass_sphere"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.enclosed_mass_sphere">[docs]</a><span class="k">def</span> <span class="nf">enclosed_mass_sphere</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reff</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the surface density at that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : floats</span>
<span class="sd">     Distance to the center in which surface density is going to be calculated (Mpc).</span>
<span class="sd">    M : floats</span>
<span class="sd">     Mass of the desired component of the galaxy (Msun).</span>
<span class="sd">    reff : floats</span>
<span class="sd">     Effective radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">     Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    surf_den : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exponential&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">profile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;STOP (eml_une): Unrecognised profile for the surface density.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;                Possible profiles= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profiles</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">profile</span><span class="o">==</span><span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">M</span><span class="o">&gt;</span><span class="mf">1e-5</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">reff</span><span class="o">&gt;</span><span class="mf">1e-5</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mass_enclosed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mass_enclosed</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mass_enclosed</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">reff</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">mass_enclosed</span></div>
    
<div class="viewcode-block" id="vol_sphere"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.vol_sphere">[docs]</a><span class="k">def</span> <span class="nf">vol_sphere</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">3</span></div>

<div class="viewcode-block" id="mean_density"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.mean_density">[docs]</a><span class="k">def</span> <span class="nf">mean_density</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">bulge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the particle density at that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : floats</span>
<span class="sd">     Distance to the center in which surface density is going to be calculated (Mpc).</span>
<span class="sd">    Ms : floats</span>
<span class="sd">     Stellar mass of the galaxy (Msun).</span>
<span class="sd">    Mg : floats</span>
<span class="sd">     Cold gas mass of the galaxy (Msun).</span>
<span class="sd">    r_hm : floats</span>
<span class="sd">     Half-mass radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">     Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exponential&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">profile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;STOP (eml_une): Unrecognised profile for the surface density.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;                Possible profiles= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profiles</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">profile</span><span class="o">==</span><span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
        <span class="n">reff</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">halfmass_to_reff</span><span class="o">*</span><span class="n">r_hm</span> <span class="c1"># GALFORM</span>
        
        <span class="k">if</span> <span class="n">bulge</span><span class="p">:</span>
            <span class="n">M_enclosed</span> <span class="o">=</span> <span class="n">enclosed_mass_sphere</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reff</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M_enclosed</span> <span class="o">=</span> <span class="n">enclosed_mass_disk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reff</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M_enclosed</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">M_enclosed</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_enclosed</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">vol_sphere</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">mp</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">kg_to_Msun</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">Mpc_to_cm</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">M_enclosed</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_enclosed</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">vol_sphere</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">mp</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">kg_to_Msun</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">Mpc_to_cm</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">n</span></div>
    
<div class="viewcode-block" id="particle_density"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.particle_density">[docs]</a><span class="k">def</span> <span class="nf">particle_density</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the particle density at that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : floats</span>
<span class="sd">      Distance to the center in which surface density is going to be calculated (Mpc).</span>
<span class="sd">    Ms : floats</span>
<span class="sd">      Stellar mass of the galaxy (Msun).</span>
<span class="sd">    Mg : floats</span>
<span class="sd">      Cold gas mass of the galaxy (Msun).</span>
<span class="sd">    r_hm : floats</span>
<span class="sd">      Half-mass radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">      Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">      If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">reff</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">halfmass_to_reff</span><span class="o">*</span><span class="n">r_hm</span> 
    
    <span class="n">den_gas</span> <span class="o">=</span> <span class="n">surface_density</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reff</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    
    <span class="c1"># h_star = const.reff_to_scale_high*reff</span>
    <span class="c1"># den_star = surface_density(x,Ms,reff,profile=profile,verbose=verbose)</span>
    <span class="c1"># gamma_gas = gamma_gas_func()</span>
    <span class="c1"># gamma_star = gamma_star_func(h_star,den_star)</span>
    <span class="c1"># Pext = 0.5*np.pi*const.G*den_gas*(den_gas + (gamma_gas/gamma_star)*den_star) * 1e10/(const.Mpc_to_cm**2)</span>
    
    <span class="n">Pext</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="n">den_gas</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">1e10</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">Mpc_to_cm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># P = nkT</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Pext</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="p">)</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">Mpc_to_cm</span><span class="o">**</span><span class="mi">3</span> <span class="c1"># cm^-3</span>
    
    <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="gamma_gas_func"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.gamma_gas_func">[docs]</a><span class="k">def</span> <span class="nf">gamma_gas_func</span><span class="p">():</span>
    
    <span class="n">gamma_gas</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#km s^-1, Lagos et al. 2011</span>
    
    <span class="k">return</span> <span class="n">gamma_gas</span></div>

<div class="viewcode-block" id="gamma_star_func"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.gamma_star_func">[docs]</a><span class="k">def</span> <span class="nf">gamma_star_func</span><span class="p">(</span><span class="n">h_star</span><span class="p">,</span><span class="n">den_star</span><span class="p">):</span>
    
    <span class="n">gamma_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="n">h_star</span><span class="o">*</span><span class="n">den_star</span><span class="p">)</span> <span class="c1"># GALFORM</span>
    
    <span class="k">return</span> <span class="n">gamma_star</span></div>
    

<div class="viewcode-block" id="mean_density_hydro_eq"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.mean_density_hydro_eq">[docs]</a><span class="k">def</span> <span class="nf">mean_density_hydro_eq</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the mean particle density within that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_r : floats</span>
<span class="sd">      Distance to the center within the surface density is going to be calculated (Mpc).</span>
<span class="sd">    Ms : floats</span>
<span class="sd">      Stellar mass of the galaxy (Msun).</span>
<span class="sd">    Mg : floats</span>
<span class="sd">      Cold gas mass of the galaxy (Msun).</span>
<span class="sd">    r_hm : floats</span>
<span class="sd">      Half-mass radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">      Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">      If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">max_r</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">max_r</span><span class="p">,</span><span class="n">max_r</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">xbin</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">particle_density</span><span class="p">(</span><span class="n">xbin</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span> <span class="c1"># cm^-3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span> <span class="c1"># cm^-3</span></div>

<div class="viewcode-block" id="calculate_ng_hydro_eq"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.calculate_ng_hydro_eq">[docs]</a><span class="k">def</span> <span class="nf">calculate_ng_hydro_eq</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the mean particle density within that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_r : floats</span>
<span class="sd">      Distance to the center within the surface density is going to be calculated (Mpc).</span>
<span class="sd">    Ms : floats</span>
<span class="sd">      Stellar mass of the galaxy (Msun).</span>
<span class="sd">    Mg : floats</span>
<span class="sd">      Cold gas mass of the galaxy (Msun).</span>
<span class="sd">    r_hm : floats</span>
<span class="sd">      Half-mass radius of the galaxy (Mpc)</span>
<span class="sd">    profile : string</span>
<span class="sd">      Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">      If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">ng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">)):</span>
            <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_density_hydro_eq</span><span class="p">(</span><span class="n">max_r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">r_hm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">)):</span>
            <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_density_hydro_eq</span><span class="p">(</span><span class="n">max_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">r_hm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">ng</span> <span class="c1"># cm^-3</span></div>
        

<div class="viewcode-block" id="epsilon_simplemodel"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.epsilon_simplemodel">[docs]</a><span class="k">def</span> <span class="nf">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span><span class="n">Mg</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">nH</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">bulge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the mass of the desired component of the galaxy, the disk effective radius</span>
<span class="sd">    and a distance to the center, it calculates the volume filling-factor within that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_r : floats</span>
<span class="sd">     Distance to the center within the surface density is going to be calculated (Mpc).</span>
<span class="sd">    Ms : floats</span>
<span class="sd">     Stellar mass of the galaxy (Msun).</span>
<span class="sd">    Mg : floats</span>
<span class="sd">     Cold gas mass of the galaxy (Msun).</span>
<span class="sd">    r_hm : floats</span>
<span class="sd">     Half-mass radius of the galaxy (Mpc).</span>
<span class="sd">    nH : float</span>
<span class="sd">     Assumed hydrogen density in the ionizing regions.</span>
<span class="sd">    profile : string</span>
<span class="sd">     Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    epsilon : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">mean_density</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span><span class="n">Mg</span><span class="p">,</span><span class="n">r_hm</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span><span class="n">bulge</span><span class="o">=</span><span class="n">bulge</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="n">nH</span>
    
    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">epsilon</span></div>

<div class="viewcode-block" id="calculate_epsilon"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.calculate_epsilon">[docs]</a><span class="k">def</span> <span class="nf">calculate_epsilon</span><span class="p">(</span><span class="n">epsilon_param</span><span class="p">,</span><span class="n">max_r</span><span class="p">,</span><span class="n">h0</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">nH</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    It reads the relevant parameters in the input file and calculates </span>
<span class="sd">    the volume filling-factor within that distance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    infile : string</span>
<span class="sd">     - Name of the input file. </span>
<span class="sd">     - In text files (*.dat, *txt, *.cat), columns separated by &#39; &#39;.</span>
<span class="sd">     - In csv files (*.csv), columns separated by &#39;,&#39;.</span>
<span class="sd">    max_r : floats</span>
<span class="sd">     Distance to the center within the surface density is going to be calculated (Mpc).</span>
<span class="sd">    epsilon_params : list</span>
<span class="sd">     Inputs for epsilon calculation (parameter for Panuzzo 2003 nebular region model).</span>
<span class="sd">     - For text or csv files: list of integers with column position.</span>
<span class="sd">     - For hdf5 files: list of data names.</span>
<span class="sd">    cut : integers</span>
<span class="sd">     Indeces of the galaxies which have survived the specified cut in the main program. </span>
<span class="sd">    h0 : float</span>
<span class="sd">     If not None: value of h, H0=100h km/s/Mpc.</span>
<span class="sd">    nH : float</span>
<span class="sd">     Assumed hydrogen density in the ionizing regions.</span>
<span class="sd">    profile : string</span>
<span class="sd">     Assumed density profile form for the surface density.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     If True print out messages.</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    epsilon : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">epsilon_param</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">#2</span>
        <span class="n">Mg</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">epsilon_param</span>
        <span class="c1"># Mg = Mg + Mg_bulge</span>
        <span class="n">ind_epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Mg</span><span class="o">&gt;</span><span class="mf">5e-5</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">r</span><span class="o">&gt;</span><span class="mf">5e-5</span><span class="p">))</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Mg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Mg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">max_r</span> <span class="o">=</span> <span class="n">max_r</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">h0</span><span class="p">:</span>
            <span class="n">ng</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span> <span class="n">epsilon</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">=</span><span class="n">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span>
                    <span class="n">Mg</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">nH</span><span class="o">=</span><span class="n">nH</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ng</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span> <span class="n">epsilon</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">=</span><span class="n">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span>
                    <span class="n">Mg</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span><span class="n">nH</span><span class="o">=</span><span class="n">nH</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mg</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">Mg_bulge</span><span class="p">,</span> <span class="n">r_bulge</span> <span class="o">=</span> <span class="n">epsilon_param</span>
        <span class="n">ind_epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Mg</span><span class="o">&gt;</span><span class="mf">5e-5</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">r</span><span class="o">&gt;</span><span class="mf">5e-5</span><span class="p">))</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Mg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Mg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">max_r</span> <span class="o">=</span> <span class="n">max_r</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">h0</span><span class="p">:</span>
            <span class="n">ng_disk</span><span class="p">,</span> <span class="n">ep_disk</span> <span class="o">=</span> <span class="n">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span>
                    <span class="n">Mg</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">nH</span><span class="o">=</span><span class="n">nH</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">ng_bulge</span><span class="p">,</span> <span class="n">ep_bulge</span> <span class="o">=</span> <span class="n">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span>
                        <span class="n">Mg_bulge</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">r_bulge</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">nH</span><span class="o">=</span><span class="n">nH</span><span class="p">,</span>
                        <span class="n">bulge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">epsilon</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">=</span> <span class="n">ep_disk</span> <span class="o">+</span> <span class="n">ep_bulge</span>
            <span class="n">ng</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">=</span> <span class="n">ng_disk</span> <span class="o">+</span> <span class="n">ng_bulge</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ng_disk</span><span class="p">,</span> <span class="n">ep_disk</span> <span class="o">=</span> <span class="n">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span>
                    <span class="n">Mg</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span><span class="n">nH</span><span class="o">=</span><span class="n">nH</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">ng_bulge</span><span class="p">,</span> <span class="n">ep_bulge</span> <span class="o">=</span> <span class="n">epsilon_simplemodel</span><span class="p">(</span><span class="n">max_r</span><span class="p">,</span>
                        <span class="n">Mg_bulge</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span><span class="n">r_bulge</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">],</span><span class="n">nH</span><span class="o">=</span><span class="n">nH</span><span class="p">,</span>
                        <span class="n">bulge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">epsilon</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">=</span> <span class="n">ep_disk</span> <span class="o">+</span> <span class="n">ep_bulge</span>
            <span class="n">ng</span><span class="p">[</span><span class="n">ind_epsilon</span><span class="p">]</span><span class="o">=</span> <span class="n">ng_disk</span> <span class="o">+</span> <span class="n">ng_bulge</span>
    
    <span class="n">epsilon</span><span class="p">[</span><span class="n">epsilon</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">epsilon</span></div>

<div class="viewcode-block" id="n_ratio2"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.n_ratio2">[docs]</a><span class="k">def</span> <span class="nf">n_ratio2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n_z0</span><span class="p">):</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">n_z0</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">ratio</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>  <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">n_z0</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">ratio</span></div>

<div class="viewcode-block" id="n_ratio"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.n_ratio">[docs]</a><span class="k">def</span> <span class="nf">n_ratio</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n_z0</span><span class="p">):</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">n_z0</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    <span class="n">mean_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">n_z0</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">mean</span><span class="o">/</span><span class="n">mean_0</span></div>
    

<div class="viewcode-block" id="Zagn"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.Zagn">[docs]</a><span class="k">def</span> <span class="nf">Zagn</span><span class="p">(</span><span class="n">logM</span><span class="p">,</span><span class="n">logz</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Estimates the metallicity of the AGN from the global metallicity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    logM : string</span>
<span class="sd">     Stellar mass of the galaxy (log10(Msun)).</span>
<span class="sd">    logz : floats</span>
<span class="sd">     Cold gas metallicity (log10(Z)).</span>
<span class="sd">     </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    logz : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">logz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">logz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span>
        <span class="n">logz</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">logz</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">logz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span>
    
    <span class="n">Ms</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">logM</span>
    <span class="n">Ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Ms</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Ms</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Ms</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Ms</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    
    <span class="c1"># logz = logz + 0.1</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ms</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">9.5</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
            <span class="n">logz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">logz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span>
        <span class="k">elif</span> <span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">10.5</span><span class="p">:</span>
            <span class="n">logz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">logz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.3</span>
        <span class="k">elif</span> <span class="n">Ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">:</span>
            <span class="n">logz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">logz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
    
    <span class="k">return</span> <span class="n">logz</span></div>

<span class="c1">######################</span>

<div class="viewcode-block" id="phot_rate"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.phot_rate">[docs]</a><span class="k">def</span> <span class="nf">phot_rate</span><span class="p">(</span><span class="n">lssfr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IMF_f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Lagn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;sfr&#39;</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;sfr&#39;</span><span class="p">:</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">lssfr</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms</span><span class="p">[:,</span><span class="n">comp</span><span class="p">])</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">IMF_SFR</span><span class="p">[</span><span class="n">IMF_f</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">phot_to_sfr_kenn</span>
            <span class="c1"># lssfr[:,comp] = np.log10(Q[:,comp]/(const.IMF_SFR[IMF_f[comp]] * const.phot_to_sfr_kenn)) - lms[:,comp]</span>
    <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;agn&#39;</span><span class="p">:</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">))</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Lagn</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Q[ind,0] = Lagn[ind]*2.3e10 # Panda 2022</span>
        <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lagn</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="mf">3.28e15</span><span class="p">)</span><span class="o">**-</span><span class="mf">1.7</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.7</span><span class="o">*</span><span class="mf">8.66e-11</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="p">)</span> <span class="c1"># Feltre 2016</span>
        <span class="c1"># This implies that Lion = Lbol/5 aprox.</span>
            
    <span class="k">return</span> <span class="n">Q</span></div>

<div class="viewcode-block" id="get_une_kashino20"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.get_une_kashino20">[docs]</a><span class="k">def</span> <span class="nf">get_une_kashino20</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">lms</span><span class="p">,</span> <span class="n">lssfr</span><span class="p">,</span> <span class="n">loh12</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">ng_ratio</span><span class="p">,</span> <span class="n">IMF_f</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given log10(Mstar), log10(sSFR), log10(Z) and the assumed IMF,</span>
<span class="sd">    get the ionizing parameter, logU, and the electron density, logne,</span>
<span class="sd">    using the model from Kashino 2020.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : floats</span>
<span class="sd">     Rate of ionizing photons (phot/s)</span>
<span class="sd">    lms : floats</span>
<span class="sd">     Masses of the galaxies per component (log10(M*) (Msun)).</span>
<span class="sd">    lssfr : floats</span>
<span class="sd">     sSFR of the galaxies per component (log10(SFR/M*) (1/yr)).</span>
<span class="sd">    loh12 : floats</span>
<span class="sd">     Metallicity of the galaxies per component (log10(Z)).</span>
<span class="sd">    IMF_f : string</span>
<span class="sd">     Assumed IMF.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lu, lne, loh12 : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lms</span><span class="p">),</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
    
    <span class="n">lssfr_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">),</span><span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lssfr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lssfr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lssfr_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">IMF_SFR</span><span class="p">[</span><span class="n">IMF_f</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">phot_to_sfr_kenn</span><span class="p">))</span> <span class="o">-</span> <span class="n">lms</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">comp</span><span class="p">]</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr_new</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">lms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">loh12</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">))</span>
    
    
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">const</span><span class="o">.</span><span class="n">ohsun</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">zsun</span><span class="p">)</span>
        
        <span class="n">lne</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.066</span> <span class="o">+</span> <span class="mf">0.310</span><span class="o">*</span><span class="p">(</span><span class="n">lms</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.492</span><span class="o">*</span><span class="p">(</span><span class="n">lssfr_new</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="mf">9.</span><span class="p">)</span>
        <span class="c1"># lne[ind] = 2</span>
        <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span><span class="mf">2.316</span> <span class="o">-</span> <span class="mf">0.360</span><span class="o">*</span><span class="p">(</span><span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span><span class="mf">8.</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.292</span><span class="o">*</span><span class="n">lne</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.428</span><span class="o">*</span><span class="p">(</span><span class="n">lssfr_new</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="mf">9.</span><span class="p">)</span>
        <span class="c1"># lu[ind] =  -3.073 - 0.137*(lms[ind]-10) + 0.372*(lssfr[ind] + 9.)</span>
        <span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">const</span><span class="o">.</span><span class="n">ohsun</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">zsun</span><span class="p">)</span> <span class="c1"># We leave it in log(Z)</span>
        
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">lms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">loh12</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">))</span>
    
    <span class="n">ind_comp</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ind_comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">lms</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">loh12</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
        
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">),</span><span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span>
    <span class="n">cte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lu</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]))</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> 
                              <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">ng_ratio</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">*</span> <span class="n">ng_ratio</span>
        
        <span class="n">cte</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>    
    
    <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cte</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span></div>

<div class="viewcode-block" id="get_une_orsi14"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.get_une_orsi14">[docs]</a><span class="k">def</span> <span class="nf">get_une_orsi14</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">lms</span><span class="p">,</span> <span class="n">lssfr</span><span class="p">,</span> <span class="n">loh12</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon0</span><span class="p">,</span> <span class="n">ng_ratio</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given log10(Mstar), log10(sSFR), log10(Z) and the values for the free parameters,</span>
<span class="sd">    get the ionizing parameter, logU, and the electron density, logne,</span>
<span class="sd">    using the model from Orsi 2014.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lms : floats</span>
<span class="sd">     Masses of the galaxies per component (log10(M*) (Msun)).</span>
<span class="sd">    lssfr : floats</span>
<span class="sd">     sSFR of the galaxies per component (log10(SFR/M*) (1/yr)).</span>
<span class="sd">    loh12 : floats</span>
<span class="sd">     Metallicity of the galaxies per component (log10(Z)).</span>
<span class="sd">    q0 : float</span>
<span class="sd">     Ionization parameter constant to calibrate Orsi 2014 model for nebular regions. q0(z/z0)^-gamma</span>
<span class="sd">    z0 : float</span>
<span class="sd">     Ionization parameter constant to calibrate Orsi 2014 model for nebular regions. q0(z/z0)^-gamma</span>
<span class="sd">    gamma : float</span>
<span class="sd">     Ionization parameter constant to calibrate Orsi 2014 model for nebular regions. q0(z/z0)^-gamma</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lu, lne, loh12 : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lms</span><span class="p">),</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">lms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">loh12</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lne</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.066</span> <span class="o">+</span> <span class="mf">0.310</span><span class="o">*</span><span class="p">(</span><span class="n">lms</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.492</span><span class="o">*</span><span class="p">(</span><span class="n">lssfr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="mf">9.</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">q0</span><span class="o">*</span><span class="p">((</span><span class="mi">10</span><span class="o">**</span><span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">/</span><span class="n">z0</span><span class="p">)</span><span class="o">**-</span><span class="n">gamma</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">lms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">loh12</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">))</span>
    
    <span class="n">ind_comp</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ind_comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">lms</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">loh12</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
        
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">),</span><span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span>
    <span class="n">cte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lu</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]))</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> 
                              <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">ng_ratio</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">*</span> <span class="n">ng_ratio</span>
        
        <span class="n">cte</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>    
    
    <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cte</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
    

    <span class="k">return</span> <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span></div>

<div class="viewcode-block" id="get_une_carton17"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.get_une_carton17">[docs]</a><span class="k">def</span> <span class="nf">get_une_carton17</span><span class="p">(</span><span class="n">lms</span><span class="p">,</span> <span class="n">lssfr</span><span class="p">,</span> <span class="n">loh12</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given log10(Mstar), log10(sSFR), log10(Z),</span>
<span class="sd">    get the ionizing parameter, logU, and the electron density, logne,</span>
<span class="sd">    using the model from Carton 2017.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lms : floats</span>
<span class="sd">     Masses of the galaxies per component (log10(M*) (Msun)).</span>
<span class="sd">    lssfr : floats</span>
<span class="sd">     sSFR of the galaxies per component (log10(SFR/M*) (1/yr)).</span>
<span class="sd">    loh12 : floats</span>
<span class="sd">     Metallicity of the galaxies per component (log10(Z)).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lu, lne, loh12 : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lms</span><span class="p">),</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">lms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">loh12</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lne</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.066</span> <span class="o">+</span> <span class="mf">0.310</span><span class="o">*</span><span class="p">(</span><span class="n">lms</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.492</span><span class="o">*</span><span class="p">(</span><span class="n">lssfr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="mf">9.</span><span class="p">)</span>
        <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">zsun</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.58</span>   

    <span class="k">return</span> <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span></div>

<div class="viewcode-block" id="get_une_panuzzo03"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.get_une_panuzzo03">[docs]</a><span class="k">def</span> <span class="nf">get_une_panuzzo03</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">lms</span><span class="p">,</span> <span class="n">lssfr</span><span class="p">,</span> <span class="n">loh12</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">epsilon0</span><span class="p">,</span> <span class="n">ng_ratio</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">IMF_f</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given the rate of ionizing photons, log10(Mstar), log10(sSFR), log10(Z),</span>
<span class="sd">    the assumed temperature for the ionizing regions, the volume filling-factor</span>
<span class="sd">    and the assumed IMF,</span>
<span class="sd">    get the ionizing parameter, logU, and the electron density, logne,</span>
<span class="sd">    using the model from Panuzzo 2003.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : floats</span>
<span class="sd">     Rate of ionizing photons (phot/s)</span>
<span class="sd">    lms : floats</span>
<span class="sd">     Masses of the galaxies per component (log10(M*) (Msun)).</span>
<span class="sd">    lssfr : floats</span>
<span class="sd">     sSFR of the galaxies per component (log10(SFR/M*) (1/yr)).</span>
<span class="sd">    loh12 : floats</span>
<span class="sd">     Metallicity of the galaxies per component (log10(Z)).</span>
<span class="sd">    T : float</span>
<span class="sd">     Typical temperature of ionizing regions.</span>
<span class="sd">    epsilon : floats</span>
<span class="sd">     Volume filling-factor of the galaxy.</span>
<span class="sd">    IMF_f : string</span>
<span class="sd">     Assumed IMF.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lu, lne, loh12 : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">loh12_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">loh12</span><span class="p">)</span>
    
    <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lms</span><span class="p">),</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">lms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">loh12_all</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">Q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    
    <span class="c1"># ind1 = np.where((lssfr[:,0] &gt; const.notnum) &amp;</span>
    <span class="c1">#                (lms[:,0] &gt; 0) &amp;</span>
    <span class="c1">#                (loh12[:,0] &gt; const.notnum) &amp;</span>
    <span class="c1">#                (Q[:,0] &gt; 0))[0]</span>
    <span class="c1"># ind2 = np.where((lssfr[:,1] &gt; const.notnum) &amp;</span>
    <span class="c1">#                (lms[:,1] &gt; 0) &amp;</span>
    <span class="c1">#                (loh12[:,1] &gt; const.notnum) &amp;</span>
    <span class="c1">#                (Q[:,1] &gt; 0))[0]</span>
    
    <span class="c1"># ind_comp = [ind1,ind2]</span>
    
    <span class="n">ind_comp</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ind_comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lssfr</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">lms</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">loh12_all</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ind</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">),</span><span class="n">const</span><span class="o">.</span><span class="n">notnum</span><span class="p">)</span>
        <span class="n">cte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lssfr</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;sfr&#39;</span><span class="p">:</span>
            <span class="c1"># lu, lne, loh12 = get_une_orsi14(Q, lms, lssfr, loh12, T, q0=const.q0_orsi, z0=const.Z0_orsi, gamma=1.3)</span>
            <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span> <span class="o">=</span> <span class="n">get_une_kashino20</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">lms</span><span class="p">,</span><span class="n">lssfr</span><span class="p">,</span><span class="n">loh12_all</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">ng_ratio</span><span class="p">,</span><span class="n">IMF_f</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lu</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]))</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> 
                                      <span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="n">ng_ratio</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">*</span> <span class="n">ng_ratio</span>
                
                <span class="n">cte</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>    
            
            <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cte</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;agn&#39;</span><span class="p">:</span>
            <span class="n">lne</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">loh12</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">loh12_all</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                
                <span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="n">epsilon0</span><span class="p">[</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span>
                
                <span class="n">cte</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">alpha_B</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">))</span> 
                 <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">epsilon</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lne</span><span class="p">[:,</span><span class="n">comp</span><span class="p">][</span><span class="n">ind_comp</span><span class="p">[</span><span class="n">comp</span><span class="p">]])</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
                
            <span class="n">cte</span><span class="p">[</span><span class="n">cte</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-50</span>
            <span class="n">lu</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cte</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">lu</span><span class="p">[</span><span class="n">cte</span><span class="o">==</span><span class="mf">1e-50</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">notnum</span>
    

    <span class="k">return</span> <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span></div>
    
<div class="viewcode-block" id="get_une"><a class="viewcode-back" href="../../source/get_nebular_emission.html#get_nebular_emission.eml_une.get_une">[docs]</a><span class="k">def</span> <span class="nf">get_une</span><span class="p">(</span><span class="n">lms_o</span><span class="p">,</span> <span class="n">lssfr_o</span><span class="p">,</span> <span class="n">loh12_o</span><span class="p">,</span>
            <span class="n">q0</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">q0_orsi</span><span class="p">,</span> <span class="n">z0</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">Z0_orsi</span><span class="p">,</span> <span class="n">Lagn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ng_ratio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">Z_central_cor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">gamma</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">epsilon_param</span><span class="o">=</span><span class="p">[[</span><span class="kc">None</span><span class="p">]],</span> <span class="n">epsilon_param_z0</span><span class="o">=</span><span class="p">[[</span><span class="kc">None</span><span class="p">]],</span>
            <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">h0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IMF_f</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Kroupa&#39;</span><span class="p">,</span><span class="s1">&#39;Kroupa&#39;</span><span class="p">],</span>
            <span class="n">redshift</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">unemod</span><span class="o">=</span><span class="s1">&#39;kashino20&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;sfr&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given log10(Mstar), log10(sSFR) and 12+log(O/H),</span>
<span class="sd">    get the ionizing parameter, U, and the electron density, ne.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lms : floats</span>
<span class="sd">     Masses of the galaxies per component (log10(M*) (Msun)).</span>
<span class="sd">    lssfr : floats</span>
<span class="sd">     sSFR of the galaxies per component (log10(SFR/M*) (1/yr)).</span>
<span class="sd">    loh12 : floats</span>
<span class="sd">     Metallicity of the galaxies per component (log10(Z)).</span>
<span class="sd">    q0 : float</span>
<span class="sd">     Ionization parameter constant to calibrate Orsi 2014 model for nebular regions. q0(z/z0)^-gamma</span>
<span class="sd">    z0 : float</span>
<span class="sd">     Ionization parameter constant to calibrate Orsi 2014 model for nebular regions. q0(z/z0)^-gamma</span>
<span class="sd">    gamma : float</span>
<span class="sd">     Ionization parameter constant to calibrate Orsi 2014 model for nebular regions. q0(z/z0)^-gamma</span>
<span class="sd">    Lagn : floats</span>
<span class="sd">     Bolometric luminosity of the AGNs (erg/s).</span>
<span class="sd">    T : float</span>
<span class="sd">     Typical temperature of ionizing regions.</span>
<span class="sd">    epsilon : floats</span>
<span class="sd">     Volume filling-factor of the galaxy.</span>
<span class="sd">    IMF_f : string</span>
<span class="sd">     Assumed IMF.</span>
<span class="sd">    unemod : string</span>
<span class="sd">     Model to go from galaxy properties to U and ne.</span>
<span class="sd">    origin : string</span>
<span class="sd">     Source of the ionizing photons.</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">     Yes = print out messages.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Q, lu, lne, loh12 : floats</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># ncomp = len(lms[0])</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">phot_rate</span><span class="p">(</span><span class="n">lssfr</span><span class="o">=</span><span class="n">lssfr_o</span><span class="p">,</span><span class="n">lms</span><span class="o">=</span><span class="n">lms_o</span><span class="p">,</span><span class="n">IMF_f</span><span class="o">=</span><span class="n">IMF_f</span><span class="p">,</span><span class="n">Lagn</span><span class="o">=</span><span class="n">Lagn</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
    
    <span class="n">epsilon</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">epsilon_param</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;agn&#39;</span><span class="p">:</span>
            <span class="n">epsilon</span> <span class="o">=</span> <span class="n">calculate_epsilon</span><span class="p">(</span><span class="n">epsilon_param</span><span class="p">,[</span><span class="n">const</span><span class="o">.</span><span class="n">radius_NLR</span><span class="p">],</span><span class="n">h0</span><span class="o">=</span><span class="n">h0</span><span class="p">,</span>
                              <span class="n">nH</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">nH_AGN</span><span class="p">,</span><span class="n">profile</span><span class="o">=</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;sfr&#39;</span><span class="p">:</span>
            <span class="c1"># ng = calculate_ng_hydro_eq(2*epsilon_param[1],epsilon_param[0],epsilon_param[1],profile=&#39;exponential&#39;,verbose=True)</span>
            <span class="c1"># epsilon = ng/const.nH_gal</span>
            <span class="c1"># epsilon[epsilon&gt;1] = 1</span>
            
            <span class="k">if</span> <span class="n">epsilon_param_z0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># ng_z0 = calculate_ng_hydro_eq(2*epsilon_param_z0[1],epsilon_param_z0[0],epsilon_param_z0[1],profile=&#39;exponential&#39;,verbose=True)</span>
                <span class="c1"># ng_ratio = n_ratio(ng,ng_z0)</span>
                <span class="k">if</span> <span class="n">redshift</span><span class="o">==</span><span class="mf">0.8</span><span class="p">:</span>
                    <span class="n">ng_ratio</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">med_to_low</span>
                <span class="k">elif</span> <span class="n">redshift</span><span class="o">==</span><span class="mf">1.5</span><span class="p">:</span>
                    <span class="n">ng_ratio</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">high_to_low</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ng_ratio</span> <span class="o">=</span> <span class="mf">1.</span>
                    
    <span class="k">if</span> <span class="n">Z_central_cor</span> <span class="ow">and</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;agn&#39;</span><span class="p">:</span>
        <span class="n">loh12</span> <span class="o">=</span> <span class="n">Zagn</span><span class="p">(</span><span class="n">lms_o</span><span class="p">,</span><span class="n">loh12_o</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loh12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">loh12_o</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">unemod</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">const</span><span class="o">.</span><span class="n">unemods</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;STOP (eml_une): Unrecognised model to get U and ne.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;                Possible unemod= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">unemods</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">unemod</span> <span class="o">==</span> <span class="s1">&#39;kashino20&#39;</span><span class="p">):</span>
        <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span> <span class="o">=</span> <span class="n">get_une_kashino20</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">lms_o</span><span class="p">,</span><span class="n">lssfr_o</span><span class="p">,</span><span class="n">loh12</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">ng_ratio</span><span class="p">,</span><span class="n">IMF_f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">unemod</span> <span class="o">==</span> <span class="s1">&#39;orsi14&#39;</span><span class="p">):</span>
        <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span> <span class="o">=</span> <span class="n">get_une_orsi14</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">lms_o</span><span class="p">,</span><span class="n">lssfr_o</span><span class="p">,</span><span class="n">loh12</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">q0</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">ng_ratio</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">unemod</span> <span class="o">==</span> <span class="s1">&#39;panuzzo03&#39;</span><span class="p">):</span>
        <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span> <span class="o">=</span> <span class="n">get_une_panuzzo03</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">lms_o</span><span class="p">,</span><span class="n">lssfr_o</span><span class="p">,</span><span class="n">loh12</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">ng_ratio</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">IMF_f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">unemod</span> <span class="o">==</span> <span class="s1">&#39;carton17&#39;</span><span class="p">):</span>
        <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span> <span class="o">=</span> <span class="n">get_une_carton17</span><span class="p">(</span><span class="n">lms_o</span><span class="p">,</span><span class="n">lssfr_o</span><span class="p">,</span><span class="n">loh12</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">Q</span><span class="p">,</span> <span class="n">lu</span><span class="p">,</span> <span class="n">lne</span><span class="p">,</span> <span class="n">loh12</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">ng_ratio</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Documentation for get_nebular_emission</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme_include.html">Get nebular emission</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Code Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/modules.html">get_nebular_emission</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">get_nebular_emission 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">get_nebular_emission.eml_une</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, GALFORM collaboration.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>